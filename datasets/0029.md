# Lizard 数据集详情

## 数据集描述

Lizard 是一个大规模的组织病理学数据集，包含来自多个数据集的结肠组织病理学图像和细胞核标注。该数据集整合了 GlaS、CRAG、CoNSeP、DigestPath、PanNuke 以及 TCGA 等多个数据集的图像，提供了丰富的细胞核实例分割标注。

## 数据集基本信息

- **器官类型**：结肠 (Colon)
- **染色方式**：H&E (Hematoxylin and Eosin)
- **数据集大小**：431,913 个细胞核实例，来自 238 个 .mat 文件
- **图像分辨率**：500-1000 不等（patch 大小）
- **放大倍数**：20x
- **数据来源**：GlaS、CRAG、CoNSeP、DigestPath、PanNuke 以及 TCGA
  - GlaS、CRAG 和 DigestPath：20x
  - CoNSeP 和 PanNuke：仅使用图片，未使用标签
  - TCGA：仅使用图片（Colon）

## 文件结构

```
lizard/
├── Lizard_Images1/
│ └── Lizard_Images1（子文件夹）
│ └── 【若干.png图片文件】（如xxx.png、yyy.png等）
│ ▶ 文件名与Lizard_Labels/Labels中的.mat文件**完全一一对应**
├── Lizard_Images2/
│ └── Lizard_Images2（子文件夹）
│ └── 【若干.png图片文件】（如xxx.png、yyy.png等）
│ ▶ 文件名与Lizard_Labels/Labels中的.mat文件**完全一一对应**
├── Lizard_Labels/
│ ├── Labels（子文件夹）
│ │ └── 【若干.mat标注文件】（如xxx.mat、yyy.mat等）
│ │ ▶ 核心：每个.mat文件名与Lizard_Images1/Lizard_Images1、Lizard_Images2/Lizard_Images2中的.png文件名**完全一致**
│ │ └── 每个.mat文件的key结构：
│ │ - **header**: bytes类型，值为b'MATLAB 5.0 MAT-file Platform: posix, Created on: Fri Jul 16 14:54:29 2021'
│ │ - **version**: str类型，值为1.0
│ │ - **globals**: list类型，值为[]
│ │ - inst_map: numpy.ndarray类型，形状为(图像高, 图像宽)，每个像素值对应实例ID（0不视为有效实例ID）
│ │ - id: numpy.ndarray类型，形状为(实例数量, 1)，每个元素为实例ID（从1开始递增）
│ │ - class: numpy.ndarray类型，形状为(实例数量, 1)，每个元素为对应实例ID的类别ID
│ │ - bbox: numpy.ndarray类型，形状为(实例数量, 4)，每个元素为对应实例ID的边界框（左上右下绝对值坐标）
│ │ - centroid: numpy.ndarray类型，形状为(实例数量, 2)，每个元素为对应实例ID的中心坐标（xy绝对值坐标）
│ ├── info.csv（文件）
│ └── read_label.py（文件）
│ └── README.md（文件）
└── Overlay/
```

## 标注格式

### .mat 文件结构

每个 `.mat` 文件包含以下字段：

- **inst_map**：numpy.ndarray，形状为 `(图像高, 图像宽)`
  - 每个像素值对应实例ID（0 不视为有效实例ID）
  - 相同ID的像素属于同一个细胞核实例

- **id**：numpy.ndarray，形状为 `(实例数量, 1)`
  - 每个元素为实例ID（从1开始递增）

- **class**：numpy.ndarray，形状为 `(实例数量, 1)`
  - 每个元素为对应实例ID的类别ID（1-6）

- **bbox**：numpy.ndarray，形状为 `(实例数量, 4)`
  - 每个元素为对应实例ID的边界框（左上右下绝对值坐标）

- **centroid**：numpy.ndarray，形状为 `(实例数量, 2)`
  - 每个元素为对应实例ID的中心坐标（xy绝对值坐标）

### 类别ID映射

mat文件中的 `class` 字段只会是 1-6 这六个整数，对应关系如下：

```python
cls_id_to_name = {
    1: "neutrophil",      # 嗜中性粒细胞
    2: "epithelial",      # 上皮细胞
    3: "lymphocyte",      # 淋巴细胞
    4: "plasma",          # 浆细胞
    5: "eosinophil",      # 嗜酸性粒细胞
    6: "connective"       # 结缔组织细胞
}
```

## 标注情况

### 标注统计

- **总细胞核实例数**：431,913 个
- **总 .mat 文件数**：238 个
- **标注完成度**：100%（所有图像均已完成标注）

### 细胞核类别统计

| 细胞核类型 | 数量 | 比例 |
|----------|------|------|
| **epithelial** (上皮细胞) | 210,372 | 48.71% |
| **lymphocyte** (淋巴细胞) | 92,238 | 21.36% |
| **connective** (结缔组织细胞) | 97,347 | 22.54% |
| **plasma** (浆细胞) | 24,861 | 5.76% |
| **neutrophil** (嗜中性粒细胞) | 4,116 | 0.95% |
| **eosinophil** (嗜酸性粒细胞) | 2,979 | 0.69% |
| **总计** | **431,913** | **100.00%** |

**注**：根据原始统计，不同统计可能有轻微差异：
- 另一种统计显示：epithelial 244,563 (49.39%), lymphocyte 101,413 (20.48%), connective 112,309 (22.68%), plasma 28,466 (5.75%), neutrophil 4,824 (0.97%), eosinophil 3,604 (0.73%)

## 数据特点

### 多数据集整合

数据集整合了多个公开数据集的图像和标注，提供了统一的标注格式和丰富的样本多样性。

### 实例级标注

数据集提供了详细的实例级标注，包括：
- 实例分割掩码（inst_map）
- 边界框（bbox）
- 中心点坐标（centroid）
- 类别标签（class）

### 类别分布

数据集包含 6 种不同类型的细胞核，其中上皮细胞占主导地位（约 48.71%），淋巴细胞和结缔组织细胞各占约 20% 左右。

## 使用建议

### 数据加载

```python
import scipy.io as sio
import numpy as np

# 加载 .mat 文件
mat_data = sio.loadmat('Lizard_Labels/Labels/xxx.mat')

# 获取实例分割掩码
inst_map = mat_data['inst_map']  # (H, W)

# 获取实例ID列表
instance_ids = mat_data['id'].flatten()  # (N,)

# 获取类别标签
classes = mat_data['class'].flatten()  # (N,)

# 获取边界框
bboxes = mat_data['bbox']  # (N, 4)

# 获取中心点坐标
centroids = mat_data['centroid']  # (N, 2)

# 类别ID到名称的映射
cls_id_to_name = {
    1: "neutrophil",
    2: "epithelial",
    3: "lymphocyte",
    4: "plasma",
    5: "eosinophil",
    6: "connective"
}
```

### 数据预处理

1. **图像归一化**：建议对图像进行标准化处理
2. **类别平衡**：注意不同类别细胞核的数量不平衡问题
3. **实例提取**：从 inst_map 中提取每个实例的掩码和类别

### 模型选择

1. **实例分割**：推荐使用 Mask R-CNN、HoVer-Net、StarDist 等模型
2. **细胞核分类**：可以结合实例分割和分类任务
3. **多任务学习**：可以同时进行分割和分类任务

### 评估指标

- **实例分割**：使用 Dice 系数、IoU、F1-score、PQ (Panoptic Quality)
- **分类任务**：使用准确率、精确率、召回率、F1-score、混淆矩阵

## 相关资源

- [数据集下载](https://warwick.ac.uk/fac/cross_fac/tia/data/lizard/)
- [Kaggle 数据集](https://www.kaggle.com/datasets/aadimator/lizard-dataset)
- [论文链接](https://arxiv.org/pdf/2108.11195.pdf)

## 引用

如果您使用了此数据集，请引用：

```bibtex
@article{lizard2021,
  title={Lizard: A Large-Scale Dataset for Colonic Nuclear Instance Segmentation and Classification},
  author={Graham, Simon and Jahanifar, Mostafa and Azam, Ayesha and Nimir, Mohammed and Tsang, Yee-Wah and Dodd, Kevin and Hero, Emma and Sahota, Harvir and Tank, Akshay and Benes, Ksenija and others},
  journal={arXiv preprint arXiv:2108.11195},
  year={2021}
}
```

## 注意事项

1. **数据使用许可**：请遵守数据集的使用许可协议
2. **数据格式**：标注文件使用 MATLAB .mat 格式，需要使用 scipy.io 或 h5py 加载
3. **类别不平衡**：不同类别细胞核数量差异较大，建议使用适当的采样策略或损失函数
4. **数据来源**：数据集整合了多个数据集的图像，使用时请注意各原始数据集的许可协议
